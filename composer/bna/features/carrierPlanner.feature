##
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


Feature: CarrierPlanner feature test

  Background:
    Given I have deployed the business network definition ..
    And I have added the following participants of type org.digitalcmr.CarrierPlanner
    """
    {"$class":"org.digitalcmr.CarrierPlanner", "userID": "pete@koopman.org", "userName": "pete", "firstName": "Pete", "lastName": "compy", "address": {"$class": "org.digitalcmr.Address", "name": "pete compy", "street": "compenstraat", "houseNumber": "18", "city": "Amsterdam", "zipCode": "9867UG", "country": "Netherlands", "latitude": 52.2443, "longitude": 65.2323, "id":"id"},"org":"koopman"}
    """
    And I have issued the participant org.digitalcmr.CarrierPlanner#pete@koopman.org with the identity Pete
    And I have added the following assets of type org.digitalcmr.TransportOrder
    """
    { "$class": "org.digitalcmr.TransportOrder", "orderID": "A12345567890", "loading": { "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "delivery": { "$class": "org.digitalcmr.Delivery", "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "owner": "leaseplan", "source": "amsterdamcompound", "carrier": "koopman", "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "183726339N", "manufacturer": "Audi", "model": "A1", "type": "sportback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "AV198RX" }, "description": "vehicle", "weight": 1500, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 }, { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE" }, "description": "vehicle", "weight": 1800, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 } ], "status": "OPEN", "issueDate": 1502834400000, "ecmrs": [], "orderRef": "ref" }
    { "$class": "org.digitalcmr.TransportOrder", "orderID": "B12345567890", "loading": { "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "delivery": { "$class": "org.digitalcmr.Delivery", "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "owner": "leaseplan", "source": "amsterdamcompound", "carrier": "notKoopman", "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "183726339N", "manufacturer": "Audi", "model": "A1", "type": "sportback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "AV198RX" }, "description": "vehicle", "weight": 1500, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 }, { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE" }, "description": "vehicle", "weight": 1800, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 } ], "status": "OPEN", "issueDate": 1502834400000, "ecmrs": [], "orderRef": "ref" }
    """

  Scenario: Pete can read all of his TransportOrders where he is carrier
    When I use the identity Pete
    Then I should have the following assets of type org.digitalcmr.TransportOrder
    """
    { "$class": "org.digitalcmr.TransportOrder", "orderID": "12345567890", "loading": { "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "delivery": { "$class": "org.digitalcmr.Delivery", "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "owner": "leaseplan", "source": "amsterdamcompound", "carrier": "koopman", "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "183726339N", "manufacturer": "Audi", "model": "A1", "type": "sportback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "AV198RX" }, "description": "vehicle", "weight": 1500, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 }, { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE" }, "description": "vehicle", "weight": 1800, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 } ], "status": "OPEN", "issueDate": 1502834400000, "ecmrs": [], "orderRef": "ref" }
    """

  Scenario: Pete cannot read Transport Orders where is is not carrier
    When I use the identity Pete
    Then I should not have the following assets of type org.digitalcmr.TransportOrder
    """
    { "$class": "org.digitalcmr.TransportOrder", "orderID": "B12345567890", "loading": { "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "delivery": { "$class": "org.digitalcmr.Delivery", "actualDate": 1502834400000, "expectedDate": 1502835400000, "address": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 } }, "owner": "leaseplan", "source": "amsterdamcompound", "carrier": "notKoopman", "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "183726339N", "manufacturer": "Audi", "model": "A1", "type": "sportback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "AV198RX" }, "description": "vehicle", "weight": 1500, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 }, { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE" }, "description": "vehicle", "weight": 1800, "loadingStartDate": 1502834400000, "loadingEndDate": 1502834400000, "deliveryStartDate": 1502834400000, "deliveryEndDate": 1502834400000 } ], "status": "OPEN", "issueDate": 1502834400000, "ecmrs": [], "orderRef": "ref" }
    """