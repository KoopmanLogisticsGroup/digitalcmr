##
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# Use a json formatter and minify
# https://jsonformatter.org/

Feature: Recipient feature test

  Background:
    Given I have deployed the business network definition ..
    And I have added the following participants of type org.digitalcmr.CarrierMember
      """
      {"$class":"org.digitalcmr.RecipientMember", "userID": "rob@cardealer.org", "userName": "rob", "firstName": "Rob", "lastName": "Carman", "address": {"$class": "org.digitalcmr.Address", "name": "willem compy", "street": "compenstraat", "houseNumber": "18", "city": "Amsterdam", "zipCode": "9867UG", "country": "Netherlands", "latitude": 52.2443, "longitude": 65.2323, "id":"id"},"org":"cardealer"}
      """
    And I have issued the participant org.digitalcmr.RecipientMember#rob@cardealer.org with the identity Rob
    And I have added the following assets of type org.digitalcmr.ECMR
      """
      [
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "A1234567890", "status": "LOADED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "AAAA123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 } },
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "B1234567890", "status": "LOADED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "BB123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "notleaseplan", "source": "notamsterdamcompound", "transporter": "harry@koopman.org", "carrier": "notkoopman", "recipientOrg": "notcardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string" },
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "C1234567890", "status": "DELIVERED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "order1", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "carrierDeliverySignature": { "certificate": "harry@koopman.org", "timestamp": 0 } },
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "D1234567890", "status": "DELIVERED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "order2", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "not_rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "carrierDeliverySignature": { "certificate": "harry@koopman.org", "timestamp": 0 } },
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "E1234567890", "status": "IN_TRANSIT", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "BB123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 } }, { "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 } }
      ]
      """
    And I have added the following assets of type org.digitalcmr.TransportOrder
      """
      [
        { "$class": "org.digitalcmr.TransportOrder", "orderID": "A1234567890", "status": "IN_PROGRESS", "owner": "leaseplan", "source": "amsterdamcompound", "carrier": "koopman", "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "183726339N", "manufacturer": "Audi", "model": "A1", "type": "sportback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "AV198RX" }, "description": "vehicle", "weight": 1500,  "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 } }, { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE" }, "description": "vehicle", "weight": 1800,  "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 } } ], "status": "OPEN", "issueDate": 1502834400000, "ecmrs": [], "orderRef": "ref" },
        {"$class":"org.digitalcmr.TransportOrder","orderID":"order1","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","goods":[{"$class":"org.digitalcmr.Good","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"2131231414CN","manufacturer":"BMW","model":"X5","type":"sportsback","ecmrs":[],"odoMeterReading":0,"plateNumber":"O291RX"},"description":"vehicle","weight":1900,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"status":"IN_PROGRESS","issueDate":1502834400000,"ecmrs":["C1234567890"],"orderRef":"ref"},
        {"$class":"org.digitalcmr.TransportOrder","orderID":"order2","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","goods":[{"$class":"org.digitalcmr.Good","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"2131231414CN","manufacturer":"BMW","model":"X5","type":"sportsback","ecmrs":[],"odoMeterReading":0,"plateNumber":"O291RX"},"description":"vehicle","weight":1900,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"status":"IN_PROGRESS","issueDate":1502834400000,"ecmrs":["D1234567890"],"orderRef":"ref"}
      ]
      """

  Scenario: Rob can read all of his ECMRs where he is recipient
    When I use the identity Rob
    Then I should have the following assets of type org.digitalcmr.ECMR
      """
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "A1234567890", "status": "LOADED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "AAAA123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 } }
      """

  Scenario: Rob cannot read ECMRs where he is not the recipient
    When I use the identity Rob
    Then I should not have the following assets of type org.digitalcmr.ECMR
      """
      {"$class": "org.digitalcmr.ECMR", "ecmrID": "B1234567890", "status": "LOADED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "BB123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "notleaseplan", "source": "notamsterdamcompound", "transporter": "harry@koopman.org", "carrier": "notkoopman", "recipientOrg": "notcardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string" }
      """

  Scenario: Rob should be able to update an ECMR by using the UpdateEcmrStatusToConfirmedDelivered transaction when the status is DELIVERED
    When I use the identity Rob
    And I submit the following transaction of type org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered
      """
      {"$class":"org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered","transportOrder":"order1","ecmr":"C1234567890","signature":{"certificate":"rob@cardealer.org","timestamp":0,"generalRemark":{"comments":"something"}},"goods":[{"vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"183726339N","manufacturer":"Audi","model":"A1","type":"sportback","ecmrs":[],"odoMeterReading":0,"plateNumber":"AV198RX"},"description":"vehicle","weight":1500,"loadingAddress":{"name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"deliveryAddress":{"name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"pickupWindow":{"startDate":1502834400000,"endDate":1502834400000},"deliveryWindow":{"startDate":1502834400000,"endDate":1502834400000}},{"vehicle":{"vin":"736182CHD28172","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"deliveryAddress":{"name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"pickupWindow":{"startDate":1502834400000,"endDate":1502834400000},"deliveryWindow":{"startDate":1502834400000,"endDate":1502834400000}}]}
      """
    Then I should have the following asset of type org.digitalcmr.ECMR
      """
        {"$class": "org.digitalcmr.ECMR", "ecmrID": "C1234567890", "status": "CONFIRMED_DELIVERED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "order1", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "carrierDeliverySignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "recipientSignature": { "certificate": "rob@cardealer.org", "timestamp": 0, "generalRemark": {"$class": "org.digitalcmr.Remark", "comments": "something"} }}
      """
#    add this rule
#  rule RecipientMemberCanReadTransportOrder {
#  description: "Allow RecipientMember to READ a TransportOrder"
#  participant: "org.digitalcmr.RecipientMember"
#  operation: READ
#  resource: "org.digitalcmr.TransportOrder"
#  action: ALLOW
#  }
#    Then I should have the following asset of type org.digitalcmr.TransportOrder
#      """
#        {"$class":"org.digitalcmr.TransportOrder","orderID":"order1","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","goods":[{"$class":"org.digitalcmr.Good","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"2131231414CN","manufacturer":"BMW","model":"X5","type":"sportsback","ecmrs":[],"odoMeterReading":0,"plateNumber":"O291RX"},"description":"vehicle","weight":1900,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"status":"COMPLETED","issueDate":1502834400000,"ecmrs":["C1234567890"],"orderRef":"ref"}
#      """

  Scenario: Rob should not be able to update an ECMR by using the UpdateEcmrStatusToConfirmedDelivered transaction when the status is not DELIVERED
    When I use the identity Rob
    Given I should have the following assets of type org.digitalcmr.ECMR
      """
        {"$class": "org.digitalcmr.ECMR", "ecmrID": "A1234567890", "status": "LOADED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "AAAA123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 } }
      """
    When I submit the following transaction of type org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered
      """
        { "$class": "org.digitalcmr.UpdateEcmrStatusToLoaded", "ecmr": "resource:org.digitalcmr.ECMR#A1234567890", "ecmrID": "A1234567890", "signature": {"certificate": "resource:org.digitalcmr.User#harry@koopman.org", "timestamp": 1512652279289, "generalRemark": { "comments": "something" } }, "goods": [ { "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "183726339N", "manufacturer": "Audi", "model": "A1", "type": "sportback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "AV198RX" }, "description": "vehicle", "weight": 1500, "loadingAddress": { "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "latitude": 123, "longitude": 124 }, "deliveryAddress": { "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "latitude": 123, "longitude": 124 }, "pickupWindow": { "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "startDate": 1502834400000, "endDate": 1502834400000 } }, { "vehicle": { "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE" }, "description": "vehicle", "weight": 1800, "loadingAddress": { "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "latitude": 123, "longitude": 124 }, "deliveryAddress": { "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "latitude": 123, "longitude": 124 }, "pickupWindow": { "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "startDate": 1502834400000, "endDate": 1502834400000 } } ] }
      """
    Then I should get an error matching /Trying to set status LOADED to an ECMR with status: LOADED/

  Scenario: Rob should not be able to update an ECMR by using the UpdateEcmrStatusToConfirmedDelivered transaction whe is not the recipient
    When I use the identity Rob
    When I submit the following transaction of type org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered
      """
      {"$class":"org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered","transportOrder":"order2","ecmr":"D1234567890","signature":{"certificate":"rob@cardealer.org","timestamp":0,"generalRemark":{"comments":"something"}},"goods":[{"vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"183726339N","manufacturer":"Audi","model":"A1","type":"sportback","ecmrs":[],"odoMeterReading":0,"plateNumber":"AV198RX"},"description":"vehicle","weight":1500,"loadingAddress":{"name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"deliveryAddress":{"name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"pickupWindow":{"startDate":1502834400000,"endDate":1502834400000},"deliveryWindow":{"startDate":1502834400000,"endDate":1502834400000}},{"vehicle":{"vin":"736182CHD28172","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"deliveryAddress":{"name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","latitude":123,"longitude":124},"pickupWindow":{"startDate":1502834400000,"endDate":1502834400000},"deliveryWindow":{"startDate":1502834400000,"endDate":1502834400000}}]}
      """
    Then I should get an error matching /does not exist/

  Scenario: Rob should not be able to directly update an ECMR when the status is DELIVERED
    When I use the identity Rob
    Given I should have the following assets of type org.digitalcmr.ECMR
      """
        {"$class": "org.digitalcmr.ECMR", "ecmrID": "C1234567890", "status": "DELIVERED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "order1", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "carrierDeliverySignature": { "certificate": "harry@koopman.org", "timestamp": 0} }
      """
    When I update the following asset of type org.digitalcmr.ECMR
      """
        {"$class": "org.digitalcmr.ECMR", "ecmrID": "C1234567890", "status": "CONFIRMED_DELIVERED", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "order1", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "carrierDeliverySignature": { "certificate": "harry@koopman.org", "timestamp": 0 }, "recipientSignature": { "certificate": "rob@cardealer.org", "timestamp": 0 } }
      """
    Then I should get an error matching /does not have 'UPDATE' access to resource/

  Scenario: Rob can not create a Transport Order by using the CreateTransportOrder Transaction
    When I use the identity Rob
    Given I submit the following transaction of type org.digitalcmr.CreateTransportOrder
      """
        {"$class":"org.digitalcmr.CreateTransportOrder", "transportOrder": {"orderID":"C123456789", "status": "OPEN", "loading": {"$class": "org.digitalcmr.Loading", "address": {"$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "compenstraat", "houseNumber": "21", "city": "Amsterdam", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555}, "actualDate": 1502402400000}, "delivery": {"$class": "org.digitalcmr.Delivery", "address": {"$class": "org.digitalcmr.Address", "name": "Rob Carman", "street": "autostraat", "houseNumber": "12", "city": "Rotterdam", "zipCode": "9442KO", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623}, "actualDate": 1502488800000}, "owner": "leaseplan", "source": "amsterdamcompound", "carrier": "koopman", "issueDate":0, "orderRef": "ABC213321BCA", "goods":[{"$class":"org.digitalcmr.Good", "vehicle": {"$class": "org.digitalcmr.Vehicle", "vin": "736182CHD28172", "manufacturer": "Mercedes", "model": "SLK", "type": "Station", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "I827YE"}, "description": "vehicle", "weight": 1800, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": "1502834400000", "endDate": "1502834400000" }, "deliveryWindow": { "startDate": "1502834400000", "endDate": "1502834400000" }}], "ecmrs": []}}
      """
    Then I should get an error matching /does not have 'CREATE' access to resource/

    # todo refactor later
  Scenario: Rob should not be able to cancel a Transport Order by using the UpdateTransportOrderStatusToCancelled Transaction
    When I use the identity Rob
    Given I submit the following transaction of type org.digitalcmr.UpdateTransportOrderStatusToCancelled
      """
        { "$class": "org.digitalcmr.UpdateTransportOrderStatusToCancelled", "transportOrder": "A12345567890", "cancellation": { "cancelledBy": "pete@koopman.org", "date": 321321, "reason": "the big reason" }}
      """
    Then I should get an error

  Scenario: Rob can not update the expectedDeliveryWindow of an ECMR
    When I use the identity Rob
    Given I should have the following assets of type org.digitalcmr.ECMR
        """
          { "$class": "org.digitalcmr.ECMR", "ecmrID": "E1234567890", "status": "IN_TRANSIT", "agreementTerms": "agreement terms here", "agreementTermsSec": "agreement terms sec", "legalOwnerRef": "ASD213123S", "carrierRef": "H2238723VASD", "recipientRef": "SDADHGA21312312", "orderID": "BB123456", "creation": { "$class": "org.digitalcmr.Creation", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 52.377698, "longitude": 4.896555 }, "date": 1502402400000 }, "loading": { "$class": "org.digitalcmr.Loading", "address": { "$class": "org.digitalcmr.Address", "name": "Amsterdam Compound", "street": "Compoundstraat", "houseNumber": "21", "city": "Assen", "zipCode": "9976ZH", "country": "Netherlands", "latitude": 43.1927, "longitude": 23.3249 }, "actualDate": 1502488800000 }, "delivery": { "$class": "org.digitalcmr.Delivery", "address": { "$class": "org.digitalcmr.Address", "name": "Rob el Caro", "street": "De straat", "houseNumber": "302", "city": "Almere", "zipCode": "6736AE", "country": "Netherlands", "latitude": 51.917153, "longitude": 4.474623 }, "actualDate": 1502834400000 }, "owner": "leaseplan", "source": "amsterdamcompound", "transporter": "harry@koopman.org", "carrier": "koopman", "recipientOrg": "cardealer", "recipient": "rob@cardealer.org", "issueDate": 0, "issuedBy": "koopman", "carrierComments": "", "documents": [ "doc1" ], "goods": [ { "$class": "org.digitalcmr.Good", "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 } }, { "vehicle": { "$class": "org.digitalcmr.Vehicle", "vin": "2131231414CN", "manufacturer": "BMW", "model": "X5", "type": "sportsback", "ecmrs": [], "odoMeterReading": 0, "plateNumber": "O291RX" }, "description": "vehicle", "weight": 1900, "loadingAddress": { "$class": "org.digitalcmr.Address", "name": "loading address", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "deliveryAddress": { "$class": "org.digitalcmr.Address", "name": "delivery adress", "street": "een straat", "houseNumber": "41", "city": "Groningen", "zipCode": "7811 HC", "country": "netherlands", "longitude": 124, "latitude": 123 }, "pickupWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 }, "deliveryWindow": { "$class": "org.digitalcmr.DateWindow", "startDate": 1502834400000, "endDate": 1502834400000 } } ], "legalOwnerInstructions": "string", "paymentInstructions": "string", "payOnDelivery": "string", "compoundSignature": { "certificate": "willem@amsterdamcompound.org", "timestamp": 0 }, "carrierLoadingSignature": { "certificate": "harry@koopman.org", "timestamp": 0 } }
        """
    When I submit the following transaction of type org.digitalcmr.UpdateExpectedDeliveryWindow
        """
          {"$class": "org.digitalcmr.UpdateExpectedDeliveryWindow", "ecmr": "E1234567890", "expectedWindow": {"startDate": "7247832478934","endDate": "212213821321" }}
        """
    Then I should get an error matching /does not have 'CREATE' access to resource/