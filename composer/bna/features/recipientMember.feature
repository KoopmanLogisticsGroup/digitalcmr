##
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# Use a json formatter and minify
# https://jsonformatter.org/

Feature: Recipient feature test

  Background:
    Given I have deployed the business network definition ..
    And I have added the following participants of type org.digitalcmr.CarrierMember
      """
      {"$class":"org.digitalcmr.RecipientMember", "userID": "rob@cardealer.org", "userName": "rob", "firstName": "Rob", "lastName": "Carman", "address": {"$class": "org.digitalcmr.Address", "name": "willem compy", "street": "compenstraat", "houseNumber": "18", "city": "Amsterdam", "zipCode": "9867UG", "country": "Netherlands", "latitude": 52.2443, "longitude": 65.2323, "id":"id"},"org":"cardealer"}
      """
    And I have issued the participant org.digitalcmr.RecipientMember#rob@cardealer.org with the identity Rob
    And I have added the following participants of type org.digitalcmr.LegalOwnerAdmin
      """
        {"$class":"org.digitalcmr.LegalOwnerAdmin","userID":"lapo@leaseplan.org","userName": "lapo", "firstName":"lapo","lastName":"kelkann","address":{"$class":"org.digitalcmr.Address","name":"lapo kelkann","street":"leesenstraat","houseNumber":"20","city":"Utrecht","zipCode":"9867RF","country":"Netherlands", "latitude":"31231231.1231", "longitude":"31231231.1231", "id":"id"},"org":"leaseplan"}
      """
    And I have issued the participant org.digitalcmr.LegalOwnerAdmin#lapo@leaseplan.org with the identity Lapo
    And I have added the following assets of type org.digitalcmr.Vehicle
      """
      [
        {"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Audi","model":"A1","type":"sportback","ecmrs":[],"odoMeterReading":0,"plateNumber":"AV198RX"},
        {"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Audi","model":"A1","type":"sportback","ecmrs":[],"odoMeterReading":0,"plateNumber":"AV198RX"}
      ]
      """
    And I have added the following assets of type org.digitalcmr.TransportOrder
      """
      [
        {"$class":"org.digitalcmr.TransportOrder","orderID":"stayInProgress","status":"IN_PROGRESS","owner":"leaseplan","carrier":"koopman","issueDate":0,"orderRef":"orderRef","goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"ecmrs":["moveToConfirmedDelivered1","moveToConfirmedDelivered2"]},
        {"$class":"org.digitalcmr.TransportOrder","orderID":"moveToCompleted","status":"IN_PROGRESS","owner":"leaseplan","carrier":"koopman","issueDate":0,"orderRef":"orderRef","goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}},{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"ecmrs":["moveToConfirmedDelivered3","moveToConfirmedDelivered4"]}
      ]
      """
    And I have added the following assets of type org.digitalcmr.ECMR
      """
      [
        {"$class":"org.digitalcmr.ECMR","ecmrID":"readAll","status":"CREATED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"A12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"notRecipient","status":"CREATED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"A12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"notCardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"notRecipientMember","status":"CREATED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"A12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"bob@notCardelear.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveInTransit","status":"LOADED","compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"C12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"noCompoundSignature","status":"LOADED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"C12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"readNotTransporter","status":"LOADED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"B12345ORDER","owner":"notLeaseplan","source":"notAmsterdamcompound","carrier":"koopman","recipient":"notCardealer","transporter":"sam@notKoopman.org","recipientMember":"james@notCardelear.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToDelivered","status":"IN_TRANSIT","carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"C12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"noCarrierDeliverySignature","status":"IN_TRANSIT","compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"C12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered1","status":"DELIVERED","carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered2","status":"DELIVERED","carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered3","status":"DELIVERED","carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"},
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered4","status":"DELIVERED","carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      ]
      """

  Scenario: Rob should be able to read all of his ECMRs where his org is recipient and he is recipientMember
    When I use the identity Rob
    Then I should have the following assets of type org.digitalcmr.ECMR
      """
        {"$class":"org.digitalcmr.ECMR","ecmrID":"readAll","status":"CREATED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"A12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      """

  Scenario: Rob should not be able to read ECMRs where his org is not recipient
    When I use the identity Rob
    Then I should not have the following assets of type org.digitalcmr.ECMR
      """
        {"$class":"org.digitalcmr.ECMR","ecmrID":"notRecipient","status":"CREATED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"A12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"notCardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      """

  Scenario: Rob should not be able to read ECMRs where he is not the recipientMember
    When I use the identity Rob
    Then I should not have the following assets of type org.digitalcmr.ECMR
      """
        {"$class":"org.digitalcmr.ECMR","ecmrID":"notRecipientMember","status":"CREATED","agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"A12345ORDER","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"bob@notCardelear.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      """

  Scenario: Rob should be able to update an ECMR by using the UpdateEcmrStatusToConfirmedDelivered transaction when the status is DELIVERED, the recipient is his org and he is the recipientMember
    When I use the identity Rob
    And I submit the following transaction of type org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered
      """
        {"$class":"org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered","transportOrder":"stayInProgress","ecmr":"moveToConfirmedDelivered1","signature":{"certificate":"whatever","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}},{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}]}
      """
    Then I should have the following asset of type org.digitalcmr.ECMR
      """
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered1","status":"CONFIRMED_DELIVERED","recipientSignature":{"certificate":"rob@cardealer.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      """
    When I use the identity Lapo
    Then I should have the following asset of type org.digitalcmr.TransportOrder
      """
        {"$class":"org.digitalcmr.TransportOrder","orderID":"stayInProgress","status":"IN_PROGRESS","owner":"leaseplan","carrier":"koopman","issueDate":0,"orderRef":"orderRef","goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"ecmrs":["moveToConfirmedDelivered1","moveToConfirmedDelivered2"]}
      """

  Scenario: Rob should be able to update an ECMR by using the UpdateEcmrStatusToConfirmedDelivered transaction and the status of the TransportOrder to COMPLETED
    When I use the identity Rob
    And I submit the following transaction of type org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered
      """
        {"$class":"org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered","transportOrder":"moveToCompleted","ecmr":"moveToConfirmedDelivered3","signature":{"certificate":"whatever","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}},{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}]}
      """
    Then I should have the following asset of type org.digitalcmr.ECMR
      """
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered3","status":"CONFIRMED_DELIVERED","recipientSignature":{"certificate":"rob@cardealer.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      """
    When I use the identity Lapo
    Then I should have the following asset of type org.digitalcmr.TransportOrder
      """
        {"$class":"org.digitalcmr.TransportOrder","orderID":"moveToCompleted","status":"IN_PROGRESS","owner":"leaseplan","carrier":"koopman","issueDate":0,"orderRef":"orderRef","goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}},{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"ecmrs":["moveToConfirmedDelivered3","moveToConfirmedDelivered4"]}
      """
    When I use the identity Rob
    And I submit the following transaction of type org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered
      """
        {"$class":"org.digitalcmr.UpdateEcmrStatusToConfirmedDelivered","transportOrder":"moveToCompleted","ecmr":"moveToConfirmedDelivered4","signature":{"certificate":"whatever","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}},{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}]}
      """
    Then I should have the following asset of type org.digitalcmr.ECMR
      """
        {"$class":"org.digitalcmr.ECMR","ecmrID":"moveToConfirmedDelivered4","status":"CONFIRMED_DELIVERED","recipientSignature":{"certificate":"rob@cardealer.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierDeliverySignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"carrierLoadingSignature":{"certificate":"harry@koopman.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"compoundSignature":{"certificate":"willem@amsterdamcompound.org","timestamp":1512652279289,"generalRemark":{"comments":"something"}},"agreementTerms":"agreement terms here","agreementTermsSec":"agreement terms sec","legalOwnerRef":"ASD213123S","carrierRef":"H2238723VASD","recipientRef":"SDADHGA21312312","orderID":"stayInProgress","owner":"leaseplan","source":"amsterdamcompound","carrier":"koopman","recipient":"cardealer","transporter":"harry@koopman.org","recipientMember":"rob@cardealer.org","creation":{"$class":"org.digitalcmr.Creation","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":52.377698,"longitude":4.896555},"date":1502402400000},"loading":{"$class":"org.digitalcmr.Loading","address":{"$class":"org.digitalcmr.Address","name":"Amsterdam Compound","street":"Compoundstraat","houseNumber":"21","city":"Assen","zipCode":"9976ZH","country":"Netherlands","latitude":43.1927,"longitude":23.3249},"actualDate":1502488800000},"delivery":{"$class":"org.digitalcmr.Delivery","address":{"$class":"org.digitalcmr.Address","name":"Rob el Caro","street":"De straat","houseNumber":"302","city":"Almere","zipCode":"6736AE","country":"Netherlands","latitude":51.917153,"longitude":4.474623},"actualDate":1502834400000},"issueDate":0,"issuedBy":"koopman","carrierComments":"","documents":[],"goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"legalOwnerInstructions":"string","paymentInstructions":"string","payOnDelivery":"string"}
      """
    When I use the identity Lapo
    Then I should have the following asset of type org.digitalcmr.TransportOrder
      """
        {"$class":"org.digitalcmr.TransportOrder","orderID":"moveToCompleted","status":"COMPLETED","owner":"leaseplan","carrier":"koopman","issueDate":0,"orderRef":"orderRef","goods":[{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"A12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}},{"$class":"org.digitalcmr.Good","source":"amsterdamcompound","recipient":"cardealer","vehicle":{"$class":"org.digitalcmr.Vehicle","vin":"B12345VIN","manufacturer":"Mercedes","model":"SLK","type":"Station","ecmrs":[],"odoMeterReading":0,"plateNumber":"I827YE"},"description":"vehicle","weight":1800,"loadingAddress":{"$class":"org.digitalcmr.Address","name":"loading address","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"deliveryAddress":{"$class":"org.digitalcmr.Address","name":"delivery adress","street":"een straat","houseNumber":"41","city":"Groningen","zipCode":"7811 HC","country":"netherlands","longitude":124,"latitude":123},"pickupWindow":{"$class":"org.digitalcmr.DateWindow","startDate":"1502834400000","endDate":"1502834400000"},"deliveryWindow":{"startDate":"1502834400000","endDate":"1502834400000"}}],"ecmrs":["moveToConfirmedDelivered3","moveToConfirmedDelivered4"]}
      """