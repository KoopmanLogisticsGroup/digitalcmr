---
kind: StatefulSet
apiVersion: apps/v1beta1
metadata:
    name: server-kpm-pon
spec:
    replicas: 1
    serviceName: server-kpm-pon
    template:
        metadata:
            labels:
                tier: server-kpm-pon
        spec:
            terminationGracePeriodSeconds: 10
            containers:
              - name: server-kpm-pon
                image: registry.eu-de.bluemix.net/kpm-pon-trial/digitalcmr_server
                imagePullPolicy: Always
                imagePullSecrets:
                - name: bluemix-uk-registry
                command: ["sh", "-c", "node server.js"]
                env:
                - name: NODE_ENV
                  value: kpm-pon-prod
                - name: INIT
                  value: "false"
                - name: TLS
                  value: "false"
                - name: HOST
                  value: "0.0.0.0"
                - name: PORT
                  value: "8080"
                  volumeMounts:
                    - name: kpm-pon-credentials-pv
                      mountPath: /home/composer/.composer-credentials
            nodeSelector:
              environment: kpm-pon
    volumeClaimTemplates:
        - metadata:
            name: kpm-pon-credentials-pv
          spec:
              accessModes:
                  - ReadWriteOnce
              resources:
                  requests:
                      storage: 1G
              selector:
                matchLabels:
                  vol: kpm-pon-credentials-pv
              storageClassName: ""
